{% extends 'partials/base.html' %}
{% block content %}
<div class="min-h-screen flex flex-col bg-white md:bg-gradient-to-br md:from-blue-50 md:via-cyan-50 md:to-white" style="font-family: 'Rubik', sans-serif;">
  <!-- Sidebar -->
  {% include 'partials/sidebar.html' %}

  <!-- Header: incluye menú hamburguesa solo en móvil -->
  <!-- Header móvil SOLO visible en mobile -->
  <nav class="flex md:hidden w-full px-4 py-0 items-center justify-between sticky top-0 z-50 min-h-[56px] bg-gradient-to-r from-[#13c0ec] to-[#866dfc]">
    <a href="/dashboard">
      <img src="{{ url_for('static', filename='logo.png') }}" class="h-8 w-auto" alt="Logo">
    </a>
    <div class="flex items-center gap-4">
      <a href="/notificaciones" class="relative text-white focus:outline-none">
        <i class="fas fa-bell text-lg"></i>
        <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
      </a>
      <a href="/perfil">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Avatar" class="h-8 w-8 rounded-full border-2 border-white shadow">
      </a>
      <a href="/configuracion" class="text-white focus:outline-none">
        <i class="fas fa-cog text-lg"></i>
      </a>
    </div>
  </nav>
  <!-- Main Content -->
  <div class="flex-1 flex flex-col min-h-screen md:ml-64 bg-gray-50">
    <!-- Header -->
    <!-- Header escritorio SOLO visible en md y mayor -->
    <!-- Main dashboard area -->
    <main class="flex-1 w-full max-w-7xl mx-auto px-2 md:px-4 py-4 md:py-8 font-[Rubik]">

      {% if user and user.plan %}
      <div class="w-full max-w-md mx-auto mb-8">
        <div class="bg-white rounded-xl shadow p-4 flex items-center gap-3">
          <span class="text-gray-600 font-semibold">Tu plan actual:</span>
          <span class="px-3 py-1 rounded-full bg-blue-100 text-blue-700 font-bold text-sm uppercase tracking-wider">{{ user.plan }}</span>
        </div>
      </div>

      {% elif company and company.plan %}
      <div class="w-full max-w-md mx-auto mb-8">
        <div class="bg-white rounded-xl shadow p-4 flex items-center gap-3">
          <span class="text-gray-600 font-semibold">Tu plan actual:</span>
          <span class="px-3 py-1 rounded-full bg-purple-100 text-purple-700 font-bold text-sm uppercase tracking-wider">{{ company.plan }}</span>
        </div>
      </div>
      {% endif %}

      <!-- KPI Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 mx-4 md:mx-0">
         <!-- KPI Card: Consultas -->
         <form method="POST" action="/consultar_credito" class="bg-white rounded-2xl shadow-md p-6 flex flex-col justify-between gap-2 border border-gray-100 min-h-[170px] transition hover:shadow-lg">
           {% set limite = 2 if user and user.plan == 'bronce' else None %}
           <button type="submit" style="all:unset;cursor:pointer;display:block;width:100%" {% if limite and consultas_mes >= limite %}disabled{% endif %}>
             <div class="flex items-center justify-between w-full mb-2">
               <div class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-100">
                 <i class="fas fa-credit-card text-blue-500 text-xl"></i>
               </div>
               <span class="flex items-center gap-1 bg-red-50 text-red-500 px-2 py-0.5 rounded-full text-xs font-bold">
                 <i class="fa-solid fa-arrow-down"></i> 5.02 %
               </span>
             </div>
             <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Consultas</div>
             <div class="text-base font-extrabold text-gray-900">{{ consultas_mes }}/{{ limite if limite else '∞' }}</div>
             <div class="text-gray-400 text-sm">Consultas este mes</div>
           </button>
           {% if limite and consultas_mes >= limite %}
             <span class="block text-xs text-red-500 mt-2 text-center font-semibold">Has alcanzado el límite de consultas para tu plan este mes.<br>Por favor, actualiza tu plan para obtener más consultas o espera al próximo mes para continuar.</span>
           {% endif %}
         </form>

         <!-- KPI Card: Score -->
         <div class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-green-100">
               <i class="fas fa-chart-line text-green-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-green-50 text-green-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-arrow-up"></i> 2.5 %
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Score Actual</div>
           <div class="text-base font-extrabold text-gray-900">{{ user.score if user else 450 }}</div>
           <div class="text-gray-400 text-sm">de 850 puntos</div>
         </div>

         <!-- KPI Card: Notificaciones -->
         <a href="/notificaciones" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-300">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-purple-100">
               <i class="fas fa-bell text-purple-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-red-50 text-red-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-exclamation"></i> Nuevas
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Notificaciones</div>
           <div class="text-lg font-extrabold text-gray-900">Ver todas</div>
           <div class="text-gray-400 text-sm">Mantente informado</div>
         </a>

         <!-- KPI Card: Alertas -->
         <a href="/alertas" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-red-300">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-red-100">
               <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-red-50 text-red-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-arrow-up"></i> 1
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Alertas</div>
           <div class="text-lg font-extrabold text-gray-900">Revisar</div>
           <div class="text-gray-400 text-sm">Requieren atención</div>
         </a>
      </div>

      <!-- Acciones rápidas -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8 mx-4 md:mx-0">
         <!-- Acción: Reportes -->
         <a href="/reportes_usuario" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-300">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100">
               <i class="fas fa-file-alt text-yellow-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-green-50 text-green-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-arrow-up"></i> 3.58 %
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Reportes</div>
           <div class="text-lg font-extrabold text-gray-900">Ver reportes</div>
           <div class="text-gray-400 text-sm">Historial y análisis</div>
         </a>

         <!-- Acción: Historial -->
         <a href="/historial_credito" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-green-300">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-green-100">
               <i class="fas fa-history text-green-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-blue-50 text-blue-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-clock"></i> Actualizado
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Historial</div>
           <div class="text-lg font-extrabold text-gray-900">Ver historial</div>
           <div class="text-gray-400 text-sm">Cuentas y transacciones</div>
         </a>

         <!-- Acción: Análisis -->
         <a href="/analisis_score" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-purple-300">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-purple-100">
               <i class="fas fa-chart-bar text-purple-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-purple-50 text-purple-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-chart-line"></i> Nuevo
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Análisis</div>
           <div class="text-lg font-extrabold text-gray-900">Análisis Score</div>
           <div class="text-gray-400 text-sm">Tendencias y evolución</div>
         </a>
             </div>

       <!-- Acciones adicionales -->
       <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 mx-4 md:mx-0">
         <!-- Acción: Perfil -->
         <button id="abrirModalPerfil" type="button" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg w-full text-left focus:outline-none">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-cyan-100">
               <i class="fas fa-user text-cyan-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-red-50 text-red-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-arrow-down"></i> 10.35 %
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Mi Perfil</div>
           <div class="text-base font-extrabold text-gray-900">Ver</div>
           <div class="text-gray-400 text-sm">Datos y seguridad</div>
         </button>

         <!-- Acción: Planes -->
         <a href="/planes" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-yellow-300">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100">
               <i class="fas fa-crown text-yellow-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-yellow-50 text-yellow-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-star"></i> {{ user.plan|upper if user else 'BRONCE' }}
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Planes</div>
           <div class="text-lg font-extrabold text-gray-900">Ver planes</div>
           <div class="text-gray-400 text-sm">Actualizar suscripción</div>
         </a>

         <!-- Acción: Ayuda -->
         <a href="/ayuda" class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-2 border border-gray-100 transition hover:shadow-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-300">
           <div class="flex items-center justify-between w-full mb-2">
             <div class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-100">
               <i class="fas fa-question-circle text-blue-500 text-xl"></i>
             </div>
             <span class="flex items-center gap-1 bg-blue-50 text-blue-500 px-2 py-0.5 rounded-full text-xs font-bold">
               <i class="fa-solid fa-life-ring"></i> Ayuda
             </span>
           </div>
           <div class="uppercase text-xs text-gray-400 font-bold tracking-widest mb-1">Soporte</div>
           <div class="text-lg font-extrabold text-gray-900">Centro de ayuda</div>
           <div class="text-gray-400 text-sm">Preguntas frecuentes</div>
         </a>
       </div>

       <!-- Modal Perfil -->
       <div id="modalPerfil" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
           <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-2xl relative animate-fade-in">
             <button type="button" id="cerrarModalPerfil" class="absolute top-4 right-4 text-gray-400 hover:text-gray-700 text-2xl font-bold">&times;</button>
             <div class="flex items-center gap-4 mb-6">
               <i class="fas fa-user text-3xl text-[#13c0ec]"></i>
               <div>
                 <div class="text-xl font-bold text-gray-900">Mi Perfil</div>
                 <div class="text-sm text-gray-500">{{ user.nombre|capitalize }} {{ user.apellido|capitalize }} | Cédula: {{ user.cedula }}</div>
               </div>
             </div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
               <div>
                 <label class="block text-xs text-gray-400">Nombre</label>
                 <div class="font-bold text-gray-800">{{ user.nombre|capitalize }}</div>
               </div>
               <div>
                 <label class="block text-xs text-gray-400">Apellido</label>
                 <div class="font-bold text-gray-800">{{ user.apellido|capitalize }}</div>
               </div>
               <div>
                 <label class="block text-xs text-gray-400">Cédula</label>
                 <div class="font-bold text-gray-800">{{ user.cedula }}</div>
               </div>
               <div>
                 <label class="block text-xs text-gray-400">Correo electrónico</label>
                 <div class="font-bold text-gray-800">{{ user.email }}</div>
               </div>
               <div>
                 <label class="block text-xs text-gray-400">Teléfono</label>
                 <div class="font-bold text-gray-800">{{ user.telefono or '-' }}</div>
               </div>
               <div>
                 <label class="block text-xs text-gray-400">Dirección</label>
                 <div class="font-bold text-gray-800">{{ user.direccion or '-' }}</div>
               </div>
               <div>
                 <label class="block text-xs text-gray-400">Plan actual</label>
                 <div class="font-bold text-blue-700 uppercase">{{ user.plan }}</div>
               </div>
             </div>
             <a href="/cambiar_password" class="inline-block mt-4 px-4 py-2 rounded-lg bg-gradient-to-r from-[#13c0ec] to-[#866dfc] text-white font-bold shadow hover:from-[#0ea5e9] hover:to-[#7c3aed] transition">Cambiar contraseña</a>
           </div>
         </div>
         <script>
           const abrirPerfil = document.getElementById('abrirModalPerfil');
           const cerrarPerfil = document.getElementById('cerrarModalPerfil');
           const modalPerfil = document.getElementById('modalPerfil');
           abrirPerfil.addEventListener('click', () => { modalPerfil.classList.remove('hidden'); });
           cerrarPerfil.addEventListener('click', () => { modalPerfil.classList.add('hidden'); });
           window.addEventListener('click', function(e) {
             if (e.target === modalPerfil) { modalPerfil.classList.add('hidden'); }
           });
         </script>
      </div>
       <!-- Panel Central: Acciones rápidas y novedades -->

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
        <!-- Acciones rápidas -->
        <div class="md:col-span-2 flex flex-col gap-6">
          <div class="flex flex-col md:flex-row gap-6">
            <!-- Eliminado: Botón grande Consultar vida crediticia -->
          </div>
        </div>
      </div>
      <!-- Espacio para futuros widgets, gráficos o tablas -->
      <!-- <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-white rounded-2xl shadow-lg p-6">Widget o gráfico aquí</div>
        <div class="bg-white rounded-2xl shadow-lg p-6">Otro widget aquí</div>
      </div> -->
    </main>
  <!-- Bottom navbar solo en móvil -->
  <nav class="fixed bottom-0 left-0 right-0 z-40 bg-white border-t shadow-t md:hidden flex justify-around items-center h-16 px-2">
    <a href="/dashboard" class="flex flex-col items-center text-xs font-semibold text-[#6691e7]">
      <i class="fas fa-home text-lg mb-0.5"></i>
      <span>Dashboard</span>
    </a>
    <a href="#" class="flex flex-col items-center text-xs font-semibold text-[#7c7f90]">
      <i class="fas fa-users text-lg mb-0.5"></i>
      <span>Clientes</span>
    </a>
    <a href="#" class="flex flex-col items-center text-xs font-semibold text-[#7c7f90]">
      <i class="fas fa-file-alt text-lg mb-0.5"></i>
      <span>Reportes</span>
    </a>
    <a href="#" class="flex flex-col items-center text-xs font-semibold text-[#7c7f90]">
      <i class="fas fa-user text-lg mb-0.5"></i>
      <span>Perfil</span>
    </a>
  </nav>
</div>
</div>
{% endblock %}
